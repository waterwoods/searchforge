================================================================================
🚀 灰度模拟验证：90/10 流量分配
================================================================================
   Group A (灰度 ON):  10% 流量 = 60s @ 12 QPS
   Group B (控制 OFF): 90% 流量 = 540s @ 12 QPS
   总时长: 600s (~10分钟)
   优化: Async=True, Cache=True

================================================================================
🅰️  Phase 1/2: Running Canary (10% traffic, rewrite=ON)
================================================================================
🎯 LIVE 模式: 每组 60s @ 12 QPS
预计每组查询数: 720
⚡ 优化: Async Rewrite=True, Cache=True

============================================================
🅰️  Group A: Rewrite ENABLED (Async + Cache)
============================================================
  进度: 50 条查询, 10s 已过, 50s 剩余
  进度: 100 条查询, 19s 已过, 41s 剩余
  进度: 150 条查询, 29s 已过, 31s 剩余
  进度: 200 条查询, 38s 已过, 22s 剩余
  进度: 250 条查询, 48s 已过, 12s 剩余
  进度: 300 条查询, 57s 已过, 3s 剩余
✅ Group A 完成: 316 条查询, 60.1s

============================================================
🅱️  Group B: Rewrite DISABLED
============================================================
  进度: 50 条查询, 9s 已过, 51s 剩余
  进度: 100 条查询, 19s 已过, 41s 剩余
  进度: 150 条查询, 28s 已过, 32s 剩余
  进度: 200 条查询, 38s 已过, 22s 剩余
  进度: 250 条查询, 48s 已过, 12s 剩余
  进度: 300 条查询, 57s 已过, 3s 剩余
✅ Group B 完成: 315 条查询, 60.1s


================================================================================
🅱️  Phase 2/2: Running Control (90% traffic, rewrite=OFF)
================================================================================
🎯 LIVE 模式: 每组 540s @ 12 QPS
预计每组查询数: 6480
⚡ 优化: Async Rewrite=True, Cache=True

============================================================
🅰️  Group A: Rewrite ENABLED (Async + Cache)
============================================================
  进度: 50 条查询, 9s 已过, 531s 剩余
  进度: 100 条查询, 19s 已过, 521s 剩余
  进度: 150 条查询, 29s 已过, 511s 剩余
  进度: 200 条查询, 39s 已过, 501s 剩余
  进度: 250 条查询, 48s 已过, 492s 剩余
  进度: 300 条查询, 58s 已过, 482s 剩余
  进度: 350 条查询, 67s 已过, 473s 剩余
  进度: 400 条查询, 78s 已过, 462s 剩余
  进度: 450 条查询, 87s 已过, 453s 剩余
  进度: 500 条查询, 97s 已过, 443s 剩余
  进度: 550 条查询, 106s 已过, 434s 剩余
  进度: 600 条查询, 116s 已过, 424s 剩余
  进度: 650 条查询, 126s 已过, 414s 剩余
  进度: 700 条查询, 135s 已过, 405s 剩余
  进度: 750 条查询, 145s 已过, 395s 剩余
  进度: 800 条查询, 154s 已过, 386s 剩余
  进度: 850 条查询, 164s 已过, 376s 剩余
  进度: 900 条查询, 173s 已过, 367s 剩余
  进度: 950 条查询, 183s 已过, 357s 剩余
  进度: 1000 条查询, 193s 已过, 347s 剩余
  进度: 1050 条查询, 202s 已过, 338s 剩余
  进度: 1100 条查询, 212s 已过, 328s 剩余
  进度: 1150 条查询, 222s 已过, 318s 剩余
  进度: 1200 条查询, 232s 已过, 308s 剩余
  进度: 1250 条查询, 242s 已过, 298s 剩余
  进度: 1300 条查询, 252s 已过, 288s 剩余
  进度: 1350 条查询, 261s 已过, 279s 剩余
  进度: 1400 条查询, 271s 已过, 269s 剩余
  进度: 1450 条查询, 282s 已过, 258s 剩余
  进度: 1500 条查询, 291s 已过, 249s 剩余
  进度: 1550 条查询, 301s 已过, 239s 剩余
  进度: 1600 条查询, 311s 已过, 229s 剩余
  进度: 1650 条查询, 321s 已过, 219s 剩余
  进度: 1700 条查询, 331s 已过, 209s 剩余
  进度: 1750 条查询, 341s 已过, 199s 剩余
  进度: 1800 条查询, 351s 已过, 189s 剩余
  进度: 1850 条查询, 360s 已过, 180s 剩余
  进度: 1900 条查询, 370s 已过, 170s 剩余
  进度: 1950 条查询, 380s 已过, 160s 剩余
  进度: 2000 条查询, 390s 已过, 150s 剩余
  进度: 2050 条查询, 400s 已过, 140s 剩余
  进度: 2100 条查询, 410s 已过, 130s 剩余
  进度: 2150 条查询, 420s 已过, 120s 剩余
  进度: 2200 条查询, 430s 已过, 110s 剩余
  进度: 2250 条查询, 439s 已过, 101s 剩余
  进度: 2300 条查询, 449s 已过, 91s 剩余
  进度: 2350 条查询, 459s 已过, 81s 剩余
  进度: 2400 条查询, 469s 已过, 71s 剩余
  进度: 2450 条查询, 480s 已过, 60s 剩余
  进度: 2500 条查询, 490s 已过, 50s 剩余
  进度: 2550 条查询, 500s 已过, 40s 剩余
  进度: 2600 条查询, 510s 已过, 30s 剩余
  进度: 2650 条查询, 520s 已过, 20s 剩余
  进度: 2700 条查询, 530s 已过, 10s 剩余
  进度: 2750 条查询, 540s 已过, -0s 剩余
✅ Group A 完成: 2750 条查询, 540.0s

============================================================
🅱️  Group B: Rewrite DISABLED
============================================================
  进度: 50 条查询, 10s 已过, 530s 剩余
  进度: 100 条查询, 20s 已过, 520s 剩余
  进度: 150 条查询, 30s 已过, 510s 剩余
  进度: 200 条查询, 40s 已过, 500s 剩余
  进度: 250 条查询, 49s 已过, 491s 剩余
  进度: 300 条查询, 59s 已过, 481s 剩余
  进度: 350 条查询, 70s 已过, 470s 剩余
  进度: 400 条查询, 80s 已过, 460s 剩余
  进度: 450 条查询, 90s 已过, 450s 剩余
  进度: 500 条查询, 100s 已过, 440s 剩余
  进度: 550 条查询, 109s 已过, 431s 剩余
  进度: 600 条查询, 119s 已过, 421s 剩余
  进度: 650 条查询, 129s 已过, 411s 剩余
  进度: 700 条查询, 139s 已过, 401s 剩余
  进度: 750 条查询, 148s 已过, 392s 剩余
  进度: 800 条查询, 158s 已过, 382s 剩余
  进度: 850 条查询, 168s 已过, 372s 剩余
  进度: 900 条查询, 178s 已过, 362s 剩余
  进度: 950 条查询, 188s 已过, 352s 剩余
  进度: 1000 条查询, 198s 已过, 342s 剩余
  进度: 1050 条查询, 208s 已过, 332s 剩余
  进度: 1100 条查询, 218s 已过, 322s 剩余
  进度: 1150 条查询, 228s 已过, 312s 剩余
  进度: 1200 条查询, 238s 已过, 302s 剩余
  进度: 1250 条查询, 248s 已过, 292s 剩余
  进度: 1300 条查询, 258s 已过, 282s 剩余
  进度: 1350 条查询, 268s 已过, 272s 剩余
  进度: 1400 条查询, 278s 已过, 262s 剩余
  进度: 1450 条查询, 288s 已过, 252s 剩余
  进度: 1500 条查询, 297s 已过, 243s 剩余
  进度: 1550 条查询, 307s 已过, 233s 剩余
  进度: 1600 条查询, 317s 已过, 223s 剩余
  进度: 1650 条查询, 327s 已过, 213s 剩余
  进度: 1700 条查询, 337s 已过, 203s 剩余
  进度: 1750 条查询, 347s 已过, 193s 剩余
  进度: 1800 条查询, 357s 已过, 183s 剩余
  进度: 1850 条查询, 367s 已过, 173s 剩余
  进度: 1900 条查询, 376s 已过, 164s 剩余
  进度: 1950 条查询, 386s 已过, 154s 剩余
  进度: 2000 条查询, 396s 已过, 144s 剩余
  进度: 2050 条查询, 406s 已过, 134s 剩余
  进度: 2100 条查询, 416s 已过, 124s 剩余
  进度: 2150 条查询, 426s 已过, 114s 剩余
  进度: 2200 条查询, 435s 已过, 105s 剩余
  进度: 2250 条查询, 445s 已过, 95s 剩余
  进度: 2300 条查询, 455s 已过, 85s 剩余
  进度: 2350 条查询, 465s 已过, 75s 剩余
  进度: 2400 条查询, 474s 已过, 66s 剩余
  进度: 2450 条查询, 484s 已过, 56s 剩余
  进度: 2500 条查询, 494s 已过, 46s 剩余
  进度: 2550 条查询, 504s 已过, 36s 剩余
  进度: 2600 条查询, 513s 已过, 27s 剩余
  进度: 2650 条查询, 523s 已过, 17s 剩余
  进度: 2700 条查询, 533s 已过, 7s 剩余
✅ Group B 完成: 2735 条查询, 540.1s


================================================================================
📊 统计分析中...
================================================================================

💾 报告已生成:
  HTML: reports/rag_rewrite_ab.html
  JSON: reports/rag_rewrite_ab.json
⏱️  总运行时间: 1200.3s

================================================================================
🎯 灰度测试总结 (10% 流量)
================================================================================

【核心指标】
  ΔRecall@10: +46.94% (绝对值: +0.1464)
  ΔP95 延迟: -1.9ms
  Cache Hit: 90.5%
  Async Hit: 9.5%
  失败率: 0.00%

【生产门禁检查】
  ✓ ΔRecall≥5% (0.1464)
  ✓ p<0.05 (0.0000)
  ✓ ΔP95≤5ms (-1.9ms)
  ✓ 失败率<1% (0.00%)
  ✓ 成本≤$0.00005 ($0.000050)

【附加指标】
  Cache Hit Rate: 90.5% (✓ >90%)
  Async Hit Rate: 9.5%
  每查询成本: $0.000050
  平均 Tokens In: 157.0
  平均 Tokens Out: 44.0

================================================================================
✅ PASS - 所有门禁通过 + 缓存健康
   ΔRecall=+46.9%, ΔP95=-1.9ms, p=0.0000
   cost=$0.000050, fail=0.00%, cache_hit=90.5%
   🎯 建议: 扩大至 50% 流量继续验证
================================================================================
